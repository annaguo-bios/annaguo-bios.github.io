<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Submit parallel jobs on HPC | Anna Guo <span style="font-size: 0.65em; color: inherit;">(郭安娜)</span> </title> <meta name="author" content="Anna Guo &lt;span style='font-size: 0.65em; color: inherit;'&gt;(郭安娜)&lt;/span&gt;"> <meta name="description" content="a hands-on tutorial"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/guo.jpg"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://annaguo-bios.github.io/posts/2023-09-01-parallel-job/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Anna </span>Guo <span style="font-size: 0.65em; color: inherit;">(郭安娜)</span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/Teaching/">Teaching</a> </li> <li class="nav-item "> <a class="nav-link" href="/Notes/">Notes</a> </li> <li class="nav-item "> <a class="nav-link" href="/assets/pdf/CV_Anna_academic.pdf">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Submit parallel jobs on HPC</h1> <p class="post-meta">September 1, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/code"> <i class="fas fa-hashtag fa-sm"></i> code</a>     ·   <a href="/blog/category/code"> <i class="fas fa-tag fa-sm"></i> code</a>   </p> </header> <article class="post-content"> <blockquote> <p>The workflow discussed in this post is particularly suited for scenarios in which you need to execute similar code multiple times, with each execution having a substantial time requirement. In each iteration, the code exhibits minor variations in specific input parameters. Then this is when the <em>parallel</em> computing comes into play.</p> </blockquote> <p><strong>Toy Task:</strong> Suppose I’d like to numerically evaluate the central limit theorem.</p> <p><u>Central Limit Theorem</u>: suppose \(\{X_1,X_2,\dots,X_n\}\) is a sequence of i.i.d. random variables with \(E(X_i)=\mu\) and \(Var(X_i)=\sigma^2 &lt;\infty\) then as \(n\rightarrow\infty\), \(\bar{X}\rightarrow N(\mu,\frac{\sigma^2}{n})\)</p> <h3 id="write-a-r-function-that-perform-the-task">Write a R function that perform the task</h3> <p>Create a R script, named <code class="language-plaintext highlighter-rouge">task.R</code> that simulate \(X\) with my specified sample size and seed, and output the sample mean of the simulated \(X\) values.</p> <p>The following code takes two command-line arguments <code class="language-plaintext highlighter-rouge">n</code> and <code class="language-plaintext highlighter-rouge">seed</code> and output the sample mean to a Rdata file.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandArgs</span><span class="p">(</span><span class="n">trailingOnly</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">n</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">seed</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span><span class="w">

</span><span class="c1"># generate data</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="c1"># sample mean of X</span><span class="w">
</span><span class="n">E.x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">

</span><span class="c1"># save the output</span><span class="w">
</span><span class="n">save</span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"E.x"</span><span class="p">),</span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"output_"</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">"_"</span><span class="p">,</span><span class="n">seed</span><span class="p">,</span><span class="s2">".Rdata"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <p><strong>Note:</strong>* How to create the <em>task.R</em> file in linux?</p> <ul> <li>Create a file named <em>task.R</em> with the following code</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim task.R
</code></pre></div></div> <ul> <li>type <code class="language-plaintext highlighter-rouge">i</code> to enter the insert mode, and paste the above code.</li> <li>press <code class="language-plaintext highlighter-rouge">Esc</code> to exit the insert mode, and type <code class="language-plaintext highlighter-rouge">:wq</code> to save and quit</li> </ul> <p>Upon creating the <code class="language-plaintext highlighter-rouge">task.R</code> file, we currently have one file in folder</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/paralleljobs/task-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/paralleljobs/task-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/paralleljobs/task-1400.webp"></source> <img src="/assets/img/paralleljobs/task.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>To test the code, let \(n=100\) and \(seed=10\). Run the following code:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># load R</span>
module load R

<span class="c"># run the job</span>
Rscript task.R 100 10
</code></pre></div></div> <p>It will produce a file named <code class="language-plaintext highlighter-rouge">output_100_10.Rdata</code> . Now we have two files in folder</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/paralleljobs/test_task-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/paralleljobs/test_task-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/paralleljobs/test_task-1400.webp"></source> <img src="/assets/img/paralleljobs/test_task.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="generate-the-jobs">Generate the jobs</h3> <p>We want to execute the <code class="language-plaintext highlighter-rouge">task.R</code> script for different sample sizes: 250, 500, 1000, 2000, and 4000. For each sample size, we intend to run <code class="language-plaintext highlighter-rouge">task.R</code> 1000 times by setting seeds from 1 to 1000.</p> <p>For computational efficiency, we aim to run the \(5\times 1000\) jobs in <strong>parallel</strong>. To achieve this, first create a <code class="language-plaintext highlighter-rouge">.txt</code> file that contains all the jobs with the following R code. For reproducibility, I’d like to write the following code in a file called <code class="language-plaintext highlighter-rouge">write_job.R</code>. We now have three files in folder</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/paralleljobs/writejob-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/paralleljobs/writejob-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/paralleljobs/writejob-1400.webp"></source> <img src="/assets/img/paralleljobs/writejob.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sample size</span><span class="w">
</span><span class="n">n.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">250</span><span class="p">,</span><span class="m">500</span><span class="p">,</span><span class="m">1000</span><span class="p">,</span><span class="m">2000</span><span class="p">,</span><span class="w"> </span><span class="m">4000</span><span class="p">)</span><span class="w">

</span><span class="c1"># number of simulations</span><span class="w">
</span><span class="n">nsim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">n.vec</span><span class="p">)){</span><span class="w">
  </span><span class="n">joblist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nsim</span><span class="p">){</span><span class="w">
    </span><span class="n">job</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Rscript task.R "</span><span class="p">,</span><span class="n">n.vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s2">" "</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w">
    </span><span class="n">joblist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">joblist</span><span class="p">,</span><span class="n">job</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">write.table</span><span class="p">(</span><span class="n">joblist</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"joblist_n"</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">".txt"</span><span class="p">),</span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Usually, we don’t want to submit too many jobs at a time, so I split the jobs into 5 files, named <em>joblist_n250.txt, joblist_n500.txt, joblist_n1000.txt, joblist_n2000.txt, joblist_n4000.txt</em>.</p> <p>To generate those <code class="language-plaintext highlighter-rouge">.txt</code> files, type <code class="language-plaintext highlighter-rouge">Rscript write_job.R</code> in the terminal, which will execute the R code contained in the <code class="language-plaintext highlighter-rouge">write_job.R</code> file.</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/paralleljobs/generate_job-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/paralleljobs/generate_job-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/paralleljobs/generate_job-1400.webp"></source> <img src="/assets/img/paralleljobs/generate_job.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="submit-parallel-jobs">Submit parallel jobs</h3> <p>Personally I prefer to submit parallel jobs with the help of <a href="https://github.com/ycrc/dSQ" rel="external nofollow noopener" target="_blank">dSQ</a> command.</p> <ul> <li>download dSQ (you will need to install git command first if it’s not already installed).</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Download dSQ</span>
git clone https://github.com/ycrc/dSQ

<span class="c"># Define the path to the dSQ folder</span>
<span class="nv">dsq_path</span><span class="o">=</span><span class="s2">"/path/to/my/dSQdirectory"</span>
</code></pre></div></div> <ul> <li>Generate bash jobs</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load python/3.8
module load R/4.2.2
<span class="c">##########################</span>
<span class="c"># This is step1_dsq.sh</span>
<span class="c">##########################</span>
<span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 5<span class="si">)</span><span class="p">;</span> <span class="k">do
</span>python <span class="s2">"</span><span class="nv">$dsq_path</span><span class="s2">/dSQ.py"</span> <span class="nt">--job-file</span> joblist_n<span class="nv">$i</span>.txt <span class="nt">--batch-file</span> joblist_n<span class="nv">$i</span>.sh <span class="nt">--job-name</span> n<span class="nv">$i</span> <span class="nt">--mail-type</span> ALL
<span class="k">done</span>
</code></pre></div></div> <ul> <li>Modify the bash jobs to contain email and partition information. Change the partition name as need. I’m using the <code class="language-plaintext highlighter-rouge">day-long-cpu</code> partition here.</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##########################</span>
<span class="c"># This is step2_modify.sh</span>
<span class="c">##########################</span>

<span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 5<span class="si">)</span><span class="p">;</span> <span class="k">do</span>
<span class="c"># add "python" at the last line</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s@'</span><span class="s2">"</span><span class="nv">$dsq_path</span><span class="s2">"</span><span class="s1">'/dSQBatch.py@python '</span><span class="s2">"</span><span class="nv">$dsq_path</span><span class="s2">"</span><span class="s1">'/dSQBatch.py@'</span> <span class="s2">"joblist_n</span><span class="nv">$i</span><span class="s2">.sh"</span>

<span class="c"># add email and packages</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'/#SBATCH --mail-type "ALL"/a #SBATCH --mail-user=your-email@xxx.edu\nmodule load python/3.8\nmodule load R/4.2.2'</span> joblist_n<span class="nv">$i</span>.sh

<span class="c"># specify partition name</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'1a #SBATCH --partition=day-long-cpu'</span> joblist_n<span class="nv">$i</span>.sh
<span class="k">done</span>

</code></pre></div></div> <p>Upon this step, we should have the following files in folder</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/paralleljobs/shfile-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/paralleljobs/shfile-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/paralleljobs/shfile-1400.webp"></source> <img src="/assets/img/paralleljobs/shfile.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <ul> <li>submit the jobs one by one, so we don’t abuse the cluster:)</li> </ul> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbatch joblist_n1.sh
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/paralleljobs/submit_job-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/paralleljobs/submit_job-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/paralleljobs/submit_job-1400.webp"></source> <img src="/assets/img/paralleljobs/submit_job.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The above screenshot shows that we have successfully submitted the bash job <code class="language-plaintext highlighter-rouge">joblist_n1.sh</code> and the submission id is <code class="language-plaintext highlighter-rouge">19998977</code>. <code class="language-plaintext highlighter-rouge">squeue -j 19998977</code> helps check the current status of this job, and the <code class="language-plaintext highlighter-rouge">PD</code> in the <code class="language-plaintext highlighter-rouge">ST</code> means the jobs are queued and awaiting execution; they have not commenced running yet.</p> <p>if we want to submit all the jobs at once:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">##########################</span>
<span class="c"># This is step3_submit.sh</span>
<span class="c">##########################</span>
<span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 5<span class="si">)</span><span class="p">;</span> <span class="k">do
  </span>sbatch joblist_n<span class="nv">$i</span>.sh
<span class="k">done</span>
</code></pre></div></div> <h3 id="check-job-status-using-squeue">Check job status using <code class="language-plaintext highlighter-rouge">squeue</code> </h3> <p>Upon submitting parallel jobs, we can check the job status with the <strong>squeue</strong> command.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>squeue <span class="c"># return status of all jobs of all users</span>
</code></pre></div></div> <p>Running the <code class="language-plaintext highlighter-rouge">squeue</code> command alone will display the status of all pending and running jobs across the entire cluster for all users. This provides an overview of the cluster’s current workload. By examining the output, you can get an idea of how many users have submitted jobs and how many of those jobs are actively running or waiting in the queue.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>squeue <span class="nt">--job</span> &lt;your_job_number&gt; <span class="c"># return status of jobs under &lt;your_job_number&gt;</span>
squeue <span class="nt">-u</span> &lt;your_user_name&gt; <span class="c"># return status of jobs under &lt;your_user_name&gt;</span>
</code></pre></div></div> <p>To narrow down the results returned by the <code class="language-plaintext highlighter-rouge">squeue</code> command and focus on specific jobs or jobs belonging to your user account, you can use the <code class="language-plaintext highlighter-rouge">--job</code> and <code class="language-plaintext highlighter-rouge">-u</code> options respectively.</p> <p>All the above commands will return the status of jobs via job state codes. The table below summarizes the different status codes displayed by the <code class="language-plaintext highlighter-rouge">squeue</code> command and their corresponding meanings. (<a href="https://curc.readthedocs.io/en/latest/running-jobs/squeue-status-codes.html" rel="external nofollow noopener" target="_blank">table source</a>)</p> <table> <thead> <tr> <th>Status</th> <th style="text-align: center">Code</th> <th>Explaination</th> </tr> </thead> <tbody> <tr> <td>COMPLETED</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">CD</code></td> <td>The job has completed successfully.</td> </tr> <tr> <td>COMPLETING</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">CG</code></td> <td>The job is finishing but some processes are still active.</td> </tr> <tr> <td>FAILED</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">F</code></td> <td>The job terminated with a non-zero exit code and failed to execute.</td> </tr> <tr> <td>PENDING</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">PD</code></td> <td>The job is waiting for resource allocation. It will eventually run.</td> </tr> <tr> <td>PREEMPTED</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">PR</code></td> <td>The job was terminated because of preemption by another job.</td> </tr> <tr> <td>RUNNING</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">R</code></td> <td>The job currently is allocated to a node and is running.</td> </tr> <tr> <td>SUSPENDED</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">S</code></td> <td>A running job has been stopped with its cores released to other jobs.</td> </tr> <tr> <td>STOPPED</td> <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ST</code></td> <td>A running job has been stopped with its cores retained.</td> </tr> </tbody> </table> <p>To obtain more detailed job status information and monitor the progress of jobs more effectively. Here are some additional options:</p> <ol> <li> <strong><code class="language-plaintext highlighter-rouge">--long</code></strong>: This option provides more detailed job status information beyond the basic fields.</li> <li> <strong><code class="language-plaintext highlighter-rouge">--start</code></strong>: When used with this option, <code class="language-plaintext highlighter-rouge">squeue</code> will return the estimated start time for pending jobs. This estimation is based on the current workload and resource availability in the cluster. Note that this estimation can be inaccurate, as new jobs with higher priorities or changes in resource availability can affect the actual start time of a pending job.</li> <li> <strong><code class="language-plaintext highlighter-rouge">--iterate=</code></strong>: This option allows you to automatically refresh the job status information every specified number of seconds. This feature is useful for monitoring job progress without manually re-running the command. To stop the automatic iteration, simply press <code class="language-plaintext highlighter-rouge">Ctrl+C</code>.</li> </ol> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>squeue <span class="nt">--job</span> &lt;your_job_number&gt; <span class="nt">--long</span> <span class="c"># return more detailed status info</span>
squeue <span class="nt">-u</span> &lt;your_user_name&gt; <span class="nt">--start</span> <span class="c"># return an estimated start time</span>
squeue <span class="nt">-u</span> &lt;your_user_name&gt; <span class="nt">--start</span> <span class="nt">--iterate</span><span class="o">=</span>&lt;n_seconds&gt; <span class="c"># return an estimated start time every n_seconds</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">squeue</code> command has way more options than I can introduce here. The command below allows us to check all the options that <code class="language-plaintext highlighter-rouge">squeue</code> has to offer. It will open a help page that contains all the <code class="language-plaintext highlighter-rouge">squeue </code> options along with detailed explantation. Press <code class="language-plaintext highlighter-rouge">q</code> to exit this help page.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man squeue <span class="c"># check all options of squeue command</span>
</code></pre></div></div> <h3 id="cancel-jobs-using-scancel">Cancel jobs using <code class="language-plaintext highlighter-rouge">scancel</code> </h3> <p>Sometimes we may want to cancel the submitted jobs. <code class="language-plaintext highlighter-rouge">scancel</code> is designed for this purpose and its usage is very similar to <code class="language-plaintext highlighter-rouge">squeue</code></p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scancel &lt;your_job_number&gt; <span class="c"># cancel certain job</span>
scancel &lt;your_job_number1&gt;, &lt;your_job_number2&gt;, &lt;your_job_number3&gt; <span class="c"># cancel multiple jobs</span>
scancel <span class="nt">-u</span> &lt;your_user_name&gt; <span class="c"># cancel all jobs from certain user</span>
</code></pre></div></div> <h3 id="control-queued-and-running-jobs-using-scontrol">Control queued and running jobs using <code class="language-plaintext highlighter-rouge">scontrol</code> </h3> <p>To suspend a currently running job, we can use the <code class="language-plaintext highlighter-rouge">suspend</code> command.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scontrol <span class="nb">suspend</span> &lt;your_job_number&gt;
</code></pre></div></div> <p>This will pause the currently running job and we can resume the job with <code class="language-plaintext highlighter-rouge">resume</code></p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scontrol resume &lt;your_job_number&gt;
</code></pre></div></div> <p>To hold a job that is queued but not yet running, we can use the <code class="language-plaintext highlighter-rouge">hold</code> command</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scontrol hold &lt;your_job_number&gt;
</code></pre></div></div> <p>Different from <code class="language-plaintext highlighter-rouge">suspend</code>, this <code class="language-plaintext highlighter-rouge">hold</code> command can only be applied to jobs that is currently waiting in line and not run yet. Using the <code class="language-plaintext highlighter-rouge">hold</code> command will assign lowest priority to the job such that other jobs can be run first. To cancel this holding status, we can use the <code class="language-plaintext highlighter-rouge">release</code> command.</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scontrol release &lt;your_job_number&gt;
</code></pre></div></div> <h3 id="organize-the-results">Organize the results</h3> <p>Finally, we are ready to organize the results. This step varies based on your task. In this toy example, we’d like to verify: \(\sqrt{n}(\bar{X}-0)\rightarrow N(0,1)\) Therefore, I’ll plot the kernel density estimate of \(\bar{X}\) for each sample size, and compare them with the standard normal distribution \(N(0,1)\)</p> <p>The following R code does the job.</p> <div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">latex2exp</span><span class="p">)</span><span class="w">

</span><span class="c1"># sample size</span><span class="w">
</span><span class="n">n.vec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">250</span><span class="p">,</span><span class="m">500</span><span class="p">,</span><span class="m">1000</span><span class="p">,</span><span class="m">2000</span><span class="p">,</span><span class="m">4000</span><span class="p">)</span><span class="w">

</span><span class="c1"># number of simulations</span><span class="w">
</span><span class="n">nsim</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">

</span><span class="c1"># record results  </span><span class="w">
</span><span class="n">mean_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nsim</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">n.vec</span><span class="p">))</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">n.vec</span><span class="p">)){</span><span class="w">
  
  </span><span class="c1"># sample size</span><span class="w">
  </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">n.vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
  
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">nsim</span><span class="p">){</span><span class="w">
 
    </span><span class="n">load</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"output_"</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">"_"</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s2">".Rdata"</span><span class="p">))</span><span class="w">
    
    </span><span class="c1"># record bias</span><span class="w">
    </span><span class="n">mean_matrix</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">E.x</span><span class="w">
    
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">

</span><span class="c1"># plot the result with boxplot</span><span class="w">
</span><span class="n">dt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="n">n.vec</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="o">=</span><span class="n">nsim</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">mean_matrix</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">n.value</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">value</span><span class="p">)</span><span class="w">

</span><span class="c1">######################</span><span class="w">
  </span><span class="c1"># density plot</span><span class="w">
</span><span class="c1">######################</span><span class="w">
  
  </span><span class="n">p.den</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">n.value</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">factor</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_density</span><span class="p">(</span><span class="n">key_glyph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">draw_key_path</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
    </span><span class="n">xlab</span><span class="p">(</span><span class="n">TeX</span><span class="p">(</span><span class="n">r</span><span class="s1">'($\sqrt{n}E(X)$)'</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Density"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.95</span><span class="p">,</span><span class="w"> </span><span class="m">.95</span><span class="p">),</span><span class="w">
          </span><span class="n">legend.justification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"right"</span><span class="p">,</span><span class="w"> </span><span class="s2">"top"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">guides</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sample size"</span><span class="p">))</span><span class="w">
  

  </span><span class="c1"># Overlay a single normal curve</span><span class="w">
  </span><span class="n">p.den</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">p.den</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">stat_function</span><span class="p">(</span><span class="w">
      </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dnorm</span><span class="p">,</span><span class="w">
      </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
      </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">
      </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w">
      </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">
    </span><span class="p">)</span><span class="w">

</span><span class="c1"># Save the ggplot visualization to a PNG file</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dens_plot.png"</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p.den</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <p>The resulting plot:</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/paralleljobs/dens_plot-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/paralleljobs/dens_plot-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/paralleljobs/dens_plot-1400.webp"></source> <img src="/assets/img/paralleljobs/dens_plot.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <h3 id="references">References</h3> <ol> <li><a href="https://curc.readthedocs.io/en/latest/running-jobs/slurm-commands.html" rel="external nofollow noopener" target="_blank">Useful Slurm commands</a></li> <li><a href="https://curc.readthedocs.io/en/latest/running-jobs/squeue-status-codes.html" rel="external nofollow noopener" target="_blank"><code class="language-plaintext highlighter-rouge">squeue</code> status and reason codes</a></li> <li><a href="https://it.stonybrook.edu/help/kb/checking-the-status-of-a-slurm-job" rel="external nofollow noopener" target="_blank">Checking the Status of a SLURM Job</a></li> </ol> </article><div id="giscus_thread" style="max-width: 1100px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"annaguo-bios/comments","data-repo-id":"R_kgDOKOUWTA","data-category":"Announcements","data-category-id":"DIC_kwDOKOUWTM4CZBs0","data-mapping":"pathname","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2026 Anna Guo <span style="font-size: 0.65em; color: inherit;">(郭安娜)</span>. Last updated: February 17, 2026. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>